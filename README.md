### ISLE-K8s project

## Description
An attempt to take a docker-compose file generated by [isle-dc](https://github.com/islandora-devops/isle-dc) and get it running in Kubernetes.

## Status
* Removed Traefik temporarily
* `kubectl apply -k base/` applies correctly, solr does not boot

## How to use
Right now, this has only been tested on Windows 10 2004 with WSLv2 and Docker Desktop with Kubernetes enabled.

YAML files live in `base`. If new files are added, ensure they are added as resources under `base/kustomization.yaml`

```bash
git clone https://github.com/jhu-sheridan-libraries/isle-k8s
cd isle-k8s
# ensure kubectl works
kubectl cluster-info
# Create a test namespace to work in
kubectl create namespace isle-development
# Apply the kubernetes yaml using kubectl and kustomize
kubectl -n isle-development apply -k base/
``` 

This will create volumes using hostpath directories and Persistent Volume Claims for all of those. No are setup for ingress or access outside of the cluster yet.

To tear down this environment, perform the following:
```bash
kubectl -n isle-development delete -k base/
kubectl delete namespace isle-development
```

Future versions of the patches will create and destroy the namespace for you.

## Staff Patches ##
Sometimes, we need to do things to make stuff work that isn't applicable to other staff or environments. There is a `staffpatches` directory that can house specific changes. Take `staffpatches/derek` as an example. This kustomization.yaml file does the following:
1. Creates a namspace called `derek-test`
2. Applies all resources to that namespace

When run as `kubectl apply -k staffpatches/derek`, the kubectl software builds a graph knowing that it needs to create a namespace first then patches `namespace: derek-test` on all resources that are created.

`kubectl delete -k staffpatches/derek` will delete all resources created under `base` as well as the resources created in `staffpatches/derek`.

During test, demo and production deployments, we will never use `staffpatches` as they are intentionally created for individual developer deployments. We recommend that they not be committed to git and instead live on your local workstation.  We might apply it to .gitignore in the future.